# Production-ready n8n 2.6.3 with Python 3.13 support
# External task runners mode for secure code execution

services:
  n8n:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: n8n
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      # Basic Authentication
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=change_this_secure_password

      # Host Configuration
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http

      # Encryption Key
      - N8N_ENCRYPTION_KEY=change_this_32_char_encryption_key_here

      # Timezone
      - GENERIC_TIMEZONE=Asia/Qatar
      - TZ=Asia/Qatar

      # Binary Data Mode - filesystem needed for local file processing
      - N8N_DEFAULT_BINARY_DATA_MODE=filesystem
      
      # Allow Execute Command Node
      - NODES_EXCLUDE=[]
      - NODES_ALLOW_BUILTIN=ExecuteCommand
      
      # Security: Allow file access to /tmp
      - N8N_BLOCK_FILE_ACCESS_TO_N8N_FILES=false
      - N8N_RESTRICT_FILE_ACCESS_TO=/tmp/n8n_processing
      
      # Debugging: Reduced timeout (5 min) and enable debug logs
      - EXECUTIONS_TIMEOUT=300
      - N8N_LOG_LEVEL=debug
      
    volumes:
      - n8n_data:/home/node/.n8n

volumes:
  n8n_data:
